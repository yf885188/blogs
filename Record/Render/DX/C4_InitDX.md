<!-- TOC -->

- [1. 预备知识](#1-预备知识)
  - [1.1. Com 组件对象模式](#11-com-组件对象模式)
  - [1.2. 纹理格式](#12-纹理格式)
  - [1.3. 交换链和页面翻转](#13-交换链和页面翻转)
  - [1.4. 深度缓冲（z缓冲）](#14-深度缓冲z缓冲)
  - [1.5. 资源与描述符](#15-资源与描述符)
  - [1.6. MSAA](#16-msaa)
  - [1.7. 资源驻留](#17-资源驻留)
- [CPU与GPU的交互](#cpu与gpu的交互)
  - [命令队列和命令列表](#命令队列和命令列表)
  - [同步](#同步)
  - [资源转换](#资源转换)
  - [命令与多线程](#命令与多线程)
- [初始化Direct3D](#初始化direct3d)

<!-- /TOC -->
# 1. 预备知识
## 1.1. Com 组件对象模式
ComPtr方法：
- Get
- GetAddressOf
- Reset
  
## 1.2. 纹理格式
存在于DXGI_FORMAT枚举中，以DXGI_FORMAT前缀开头。

## 1.3. 交换链和页面翻转
双缓冲：
- 前台缓冲区(front buffer)
- 后台缓冲区(back buffer)
两者构成交换链

## 1.4. 深度缓冲（z缓冲）
如果用到模板缓冲区，则模板缓冲区一定会与深度缓冲绑定。

## 1.5. 资源与描述符
- 绑定Binding： 每次draw call需要绑定相关资源
- 每次绘制的时候，资源会发生变化，所以需要按需绑定
- 描述符：对送往GPU的资源进行间接绑定的轻量级结构。实际上是一个中间层，用来间接绑定

常用描述符：
- CBV/SRV/UAV: 
  - CBV:常量缓冲区视图 
  - SRV:着色器资源视图
  - UAV:无序访问视图
- RTV：渲染目标视图
- DSV：深度/模板视图

描述符堆：
存放用户程序中某种特定类型描述符的一块内存。

## 1.6. MSAA
- 一个像素包含N个子像素
- 绘制的时候，使用N倍于屏幕分辩率的后台缓冲区和深度缓冲区。计算当前的像素的值，然后更新到多边形覆盖的子像素中，多边形外的剔除掉。
- 采样的时候，根据N个子像素的值平均得到屏幕上实际像素的值。
  
与SSAA的区别：
- SSAA也是使用N倍于屏幕分辩率的后台缓冲区和深度缓冲区。但是，每个像素点的值进行了计算，精度比MSAA更高。

## 1.7. 资源驻留

# CPU与GPU的交互
## 命令队列和命令列表
- GPU：命令队列 ring buffer(环形队列缓冲)
- CPU：命令列表。
  - ExecuteCommandLists把命令列表里的命令添加到命令队列中。
  - ID3D12CommandAllocator：命令列表的内存管理类接口。可以理解为命令队列和命令列表直接的一个中间层。
  - 命令列表类型：
    - GPU可以直接使用的类型
    - 打包类型。减少命令列表构建时候的CPU开销。

## 同步
理论基础：
- flushing command queue
- fence

## 资源转换
转换资源屏障

## 命令与多线程
并行创建命令列表
- 每个线程通常都只使用各自的命令列表
- 每个线程通常都只使用各自的命令分配器
- 多个线程可以同时访问同一命令队列
- 处于性能考虑，在初始化期间就要设置最大的线程数量

# 初始化Direct3D
work flow:
- 用D3D12CreateDeivce创建ID3D12Device
- 创建一个ID3D12Fence对象，并查询描述符的大小
- 检测用户设备对4X MSAA质量级别的支持情况
- 依次创建命令队列、命令列表分配器和主命令列表
- 描述兵创建交换链
- 创建应用程序所需的描述符堆
- 调整后台缓冲区的大小，并为它创建渲染目标视图
- 创建深度/模板缓冲区及与之关联的深度/模板视图
- 设置视口和裁剪矩形



