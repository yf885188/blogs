<!-- TOC -->

- [1. 射线投射计算遮蔽](#1-射线投射计算遮蔽)
- [2. 屏幕空间环境光遮蔽（SSAO：Screen Space Ambient Occlusion）](#2-屏幕空间环境光遮蔽ssaoscreen-space-ambient-occlusion)

<!-- /TOC -->

# 1. 射线投射计算遮蔽
work flow:
- 构建场景树
- 通过网格三角形的中心点和随机方向，向各顶点投射射线，用场景树加速投射的求交计算。记录顶点相交数量和顶点重复计算的次数（被多少个三角形公用）
- 根据记录的顶点相交数量和顶点重复计算的次数，计算顶点的可及率/遮蔽因子

# 2. 屏幕空间环境光遮蔽（SSAO：Screen Space Ambient Occlusion）
原理：记录屏幕空间中的法线信息和深度信息，在当前点的一个范围内进行随机采样，根据采样点在屏幕空间内的最近可视点，并结合法线和深度信息计算遮蔽因子。

<div align="center">

![][SSAOTheory]

</div>


在屏幕空间中，判断两个点是否可及：
- 两点的depth在一个范围内
- 两点的法线夹角小于90度

work flow:
- 渲染屏幕空间下的法线和深度
- 通过VS着色器把NDC空间中的点P坐标变换到近平面投影平面中
  - x y值可以通过invProj之后除以w直接获得
  - z值需要通过视点到近平面上**点P与近平面的交点**的向量来确定
- 生成随机样点
  - 随机纹理
- 生成潜在遮蔽点
  - 根据上面生成的采样点，转换到近平面投影平面中，然后根据第二步类似的办法获取当前的潜在遮蔽点
- 进行遮蔽检测
  - 深度距离
  - 角度检测：防止自相交
- 进行双边模糊
  - 采样点太少会让最后的SSAO Map像噪点图
  - 模糊过程跟Blur类似，但是要对边缘做保留，不然边缘也会被模糊



[SSAOTheory]: ./SSAOTheory.bmp